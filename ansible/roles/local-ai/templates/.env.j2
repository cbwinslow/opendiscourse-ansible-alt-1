# ====================================
# Local AI Packaged Environment Configuration
# Ansible managed - do not edit manually
# Generated: {{ ansible_date_time.iso8601 }}
# ====================================

# ====================
# Application Settings
# ====================
APP_ENV=production
TZ={{ timezone | default('UTC') }}
NODE_ENV=production

# ====================
# n8n Workflow Automation
# ====================
# Security
N8N_ENCRYPTION_KEY={{ local_ai_n8n_encryption_key }}
N8N_USER_MANAGEMENT_JWT_SECRET={{ local_ai_n8n_jwt_secret }}

# Performance
N8N_DIAGNOSTICS_ENABLED=false
N8N_PAYLOAD_SIZE_MAX=16
N8N_METRICS=false

# Security Headers
N8N_SECURE_COOKIE=true
N8N_SECURE_HEADERS_HSTS_ENABLED=true
N8N_SECURE_HEADERS_HSTS_MAX_AGE=31536000

# ====================
# Supabase Configuration
# ====================
# Database
POSTGRES_PASSWORD={{ local_ai_postgres_password }}
POSTGRES_PORT={{ postgres_port | default('5432') }}

# Authentication
JWT_SECRET={{ local_ai_jwt_secret }}
ANON_KEY={{ local_ai_anon_key }}
SERVICE_ROLE_KEY={{ local_ai_service_role_key }}

# Admin Interface
DASHBOARD_USERNAME=supabase
DASHBOARD_PASSWORD={{ local_ai_dashboard_password }}
POOLER_TENANT_ID=8164

# Storage
STORAGE_BACKEND=file
FILE_STORAGE_BACKEND_PATH=/var/lib/supabase/storage

# ====================
# Neo4j Graph Database
# ====================
NEO4J_AUTH=neo4j/{{ local_ai_neo4j_password }}
NEO4J_dbms_memory_pagecache_size=512M
NEO4J_dbms_memory_heap_initial__size=1G
NEO4J_dbms_memory_heap_max__size=2G
NEO4J_dbms_security_procedures_unrestricted=apoc.\\\*\nNEO4J_dbms_security_procedures_allowlist=apoc.\\\*\nNEO4J_dbms_security_procedures_whitelist=apoc.\\\*\n
# ====================
# Langfuse Observability
# ====================
# Database
CLICKHOUSE_PASSWORD={{ local_ai_clickhouse_password }}
CLICKHOUSE_PORT=8123

# Storage
MINIO_ROOT_PASSWORD={{ local_ai_minio_password }}
MINIO_ROOT_USER=minioadmin
MINIO_BROWSER=on
MINIO_API_PORT=9000
MINIO_CONSOLE_PORT=9001

# Security
LANGFUSE_SALT={{ local_ai_langfuse_salt }}
NEXTAUTH_SECRET={{ local_ai_nextauth_secret }}
ENCRYPTION_KEY={{ local_ai_encryption_key }}
NEXTAUTH_URL=https://{{ langfuse_hostname | default('langfuse.opendiscourse.net') }}

# ====================
# Caddy Reverse Proxy
# ====================
# Domain Configuration
N8N_HOSTNAME={{ n8n_hostname | default('n8n.opendiscourse.net') }}
WEBUI_HOSTNAME={{ webui_hostname | default('openwebui.opendiscourse.net') }}
FLOWISE_HOSTNAME={{ flowise_hostname | default('flowise.opendiscourse.net') }}
SUPABASE_HOSTNAME={{ supabase_hostname | default('supabase.opendiscourse.net') }}
LANGFUSE_HOSTNAME={{ langfuse_hostname | default('langfuse.opendiscourse.net') }}
OLLAMA_HOSTNAME={{ ollama_hostname | default('ollama.opendiscourse.net') }}
SEARXNG_HOSTNAME={{ searxng_hostname | default('searxng.opendiscourse.net') }}
NEO4J_HOSTNAME={{ neo4j_hostname | default('neo4j.opendiscourse.net') }}

# SSL/TLS Configuration
LETSENCRYPT_EMAIL={{ letsencrypt_email | default('postmaster@opendiscourse.net') }}
ACME_CA_URI=https://acme-v02.api.letsencrypt.org/directory
SSL_POLICY=intermediate

# Security Headers
SECURITY_HEADERS_ENABLED=true
HSTS_MAX_AGE=31536000
REFERRER_POLICY=strict-origin-when-cross-origin
X_FRAME_OPTIONS=DENY
X_CONTENT_TYPE_OPTIONS=nosniff
X_XSS_PROTECTION=1; mode=block

# ====================
# Performance Tuning
# ====================
# JVM Options (for Java services)
JAVA_OPTS=-Xms1g -Xmx2g -XX:MaxMetaspaceSize=512m -XX:+UseG1GC

# Node.js Memory Limit
NODE_OPTIONS=--max-old-space-size=2048

# Python
PYTHONUNBUFFERED=1
PYTHONDONTWRITEBYTECODE=1

# ====================
# Logging & Monitoring
# ====================
# Log Levels
LOG_LEVEL=info
N8N_LOG_LEVEL=info
NEO4J_LOG_LEVEL=INFO

# Export Metrics
METRICS_ENABLED=true
PROMETHEUS_METRICS_PORT=9090

# ====================
# Network Configuration
# ====================
# Internal Network (Docker)
DOCKER_NETWORK=local-ai-network
DOCKER_NETWORK_SUBNET=172.20.0.0/16

# External Access
PUBLIC_URL=https://{{ n8n_hostname | default('n8n.opendiscourse.net') }}
INTERNAL_URL=http://localhost

# ====================
# Security Settings
# ====================
# Rate Limiting
RATE_LIMIT_ENABLED=true
RATE_LIMIT_WINDOW_MS=900000  # 15 minutes
RATE_LIMIT_MAX=100

# CORS
CORS_ORIGIN={{ n8n_hostname | default('n8n.opendiscourse.net') }}
CORS_METHODS=GET,POST,PUT,DELETE,OPTIONS
CORS_ALLOW_CREDENTIALS=true

# Security Headers
CONTENT_SECURITY_POLICY=default-src 'self';
PERMISSIONS_POLICY=geolocation=(), microphone=(), camera=()
POSTGRES_HOST=db
POSTGRES_DB=postgres
POSTGRES_PORT=5432
POSTGRES_USER=postgres